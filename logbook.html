<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <title>Logbook | Virtual Logbook</title>
  <!--  <link rel="stylesheet" href="style.css"/> -->
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #195797; /* Donkerblauw SkyTeck */
      }
      /* ðŸ”¹ Container voor titel en dashboard naast elkaar */
      .header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .header-bar h1 {
        margin: 0;
        font-size: 2rem;
      }

      /* ðŸ”¹ Dashboard-strook */
      .stats-bar {
        display: flex;
        justify-content: space-around;
        align-items: center;
        background: #003366;
        color: white;
        padding: 15px;
        border-radius: 5px;
      }

      .stat {
        text-align: center;
        margin: 0 10px;
      }
      .stat h2 {
        margin: 0;
        font-size: 1.5rem;
      }
      .stat p {
        margin: 5px 0 0 0;
        font-size: 0.9rem;
      }

      .add-btn {
        background: white;
        color: #003366;
        border: none;
        padding: 10px 15px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: bold;
        cursor: pointer;
        margin-left: 15px;
      }
      .add-btn:hover {
        background: #0055aa;
        color: white;
      }

      /* ðŸ”¹ Tabel */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 30px;
      }
      th, td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: center;
      }
      th {
        background: #003366;
        color: white;
      }
    </style>
  </head>
  <body data-title="Logbook">
    <div id="header-placeholder"></div>

    <!-- ðŸ”¹ Titel + Dashboard -->
    <div class="header-bar">
      <div class="stats-bar">
        <div class="stat">
          <h2 id="startsCount">0</h2>
          <p>Starts (24 mnd)</p>
        </div>
        <div class="stat">
          <h2 id="picHours">0</h2>
          <p>Uren PIC (24 mnd)</p>
        </div>
        <div class="stat">
          <h2 id="checkFlights">0</h2>
          <p>Checkvluchten (24 mnd)</p>
        </div>
        <a href="insertFlight.html" class="add-btn">+ Vlucht ingeven</a>
      </div>
    </div>

    <!-- ðŸ”¹ Tabel met logboek entries -->
    <table id="logTable">
      <thead>
        <tr>
          <th>Datum</th>
          <th>Type</th>
          <th>Registratie</th>
          <th>Van</th>
          <th>Naar</th>
          <th>Tijd</th>
          <th>Opmerkingen</th>
        </tr>
      </thead>
      <tbody id="logTableBody">
        <!-- Vluchten komen hier automatisch -->
      </tbody>
    </table>

    <!-- Firebase scripts -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { 
        getFirestore, collection, query, orderBy, onSnapshot 
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      // ðŸ”¹ Firebase-config
      const firebaseConfig = {
        apiKey: "AIzaSyC8nu1Bc7XRZrtsTNhi66AMwhCxEm0uwKE",
        authDomain: "virtual-logbook-f585b.firebaseapp.com",
        projectId: "virtual-logbook-f585b",
      };

      // ðŸ”¹ Init Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const tableBody = document.getElementById("logTableBody");

      // Statistiek velden
      const startsCountEl = document.getElementById("startsCount");
      const picHoursEl = document.getElementById("picHours");
      const checkFlightsEl = document.getElementById("checkFlights");

      // Datum 24 maanden terug
      const now = new Date();
      const past24m = new Date();
      past24m.setMonth(now.getMonth() - 24);

      let startsCount = 0;
      let picHours = 0;
      let checkFlights = 0;

      // ðŸ”¹ Firestore query
      const q = query(collection(db, "flights"), orderBy("date", "desc"));
      onSnapshot(q, snapshot => {
        tableBody.innerHTML = "";
        startsCount = 0;
        picHours = 0;
        checkFlights = 0;

        snapshot.forEach(doc => {
          const flight = doc.data();
          const date = new Date(flight.date);

          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${flight.date || ""}</td>
            <td>${flight.aircraft || ""}</td>
            <td>${flight.registration || ""}</td>
            <td>${flight.from || ""}</td>
            <td>${flight.to || ""}</td>
            <td>${flight.time || ""}</td>
            <td>${flight.remarks || ""}</td>
          `;
          tableBody.appendChild(row);

          // Statistieken 24 maanden
          if (date >= past24m) {
            startsCount += 1;

            // PIC uren (h:mm)
            if (flight.time) {
              const parts = flight.time.split(":");
              if (parts.length === 2) {
                picHours += parseInt(parts[0]) + parseInt(parts[1]) / 60;
              }
            }

            // Checkvluchten
            if (flight.remarks && flight.remarks.toLowerCase().includes("check")) {
              checkFlights += 1;
            }
          }
        });

        // Waarden tonen
        startsCountEl.textContent = startsCount;
        picHoursEl.textContent = picHours.toFixed(1);
        checkFlightsEl.textContent = checkFlights;
      });

      // ðŸ”¹ Header inladen
      fetch("header.html")
        .then(r => r.text())
        .then(data => {
          document.getElementById("header-placeholder").innerHTML = data;
          document.getElementById("page-title").innerText = document.title;
        });
    </script>
  </body>
</html>
